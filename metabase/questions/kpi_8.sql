SELECT DATE_TRUNC('week', e.sent_datetime AT TIME ZONE 'America/Sao_Paulo')::date AS "Semana", a.email_address AS "Conta", ROUND(AVG(e.engagement_score), 2) AS "Pontuação Média de Engajamento" FROM public.emails e JOIN public.accounts a ON e.account_id=a.id WHERE e.sent_datetime >= (CURRENT_DATE - INTERVAL '90 days') AND e.subject NOT ILIKE 'ENC:%' AND e.subject NOT ILIKE 'FW:%' GROUP BY 1, 2 ORDER BY 1, 2;
