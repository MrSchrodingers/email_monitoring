SELECT DATE_TRUNC('month', e.sent_datetime AT TIME ZONE 'America/Sao_Paulo')::date AS "MÃªs", a.email_address AS "Conta", COUNT(e.id) AS "Total Envios", ROUND(100.0 * SUM(e.is_replied::int) / NULLIF(SUM((NOT e.is_bounced)::int), 0), 2) AS "Taxa de Resposta Mensal (%)" FROM public.emails e JOIN public.accounts a ON e.account_id=a.id WHERE e.sent_datetime >= DATE_TRUNC('year', CURRENT_DATE) AND e.subject NOT ILIKE 'ENC:%' AND e.subject NOT ILIKE 'FW:%' GROUP BY 1, 2 ORDER BY 1, 2;
