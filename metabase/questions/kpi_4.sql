SELECT a.email_address AS "Conta", ROUND(100.0*SUM((e.temperature_label='quente')::int)/COUNT(*),1) AS "% Quente", ROUND(100.0*SUM((e.temperature_label='morno')::int)/COUNT(*),1) AS "% Morno", ROUND(100.0*SUM((e.temperature_label='frio')::int)/COUNT(*),1) AS "% Frio", COUNT(*) AS "Total Envios" FROM public.emails e JOIN public.accounts a ON a.id=e.account_id WHERE e.sent_datetime >= (CURRENT_DATE - INTERVAL '30 days') AND e.subject NOT ILIKE 'ENC:%' AND e.subject NOT ILIKE 'FW:%' GROUP BY 1 ORDER BY 2 DESC;
