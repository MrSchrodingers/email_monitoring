SELECT a.email_address AS "Conta", e.engagement_score AS "Pontuação", COUNT(*) AS "Total de Respostas", TO_CHAR((AVG(e.reply_latency_sec) || ' second')::interval, 'DD"d "HH24:MI:SS') AS "Latência Média" FROM public.emails e JOIN public.accounts a ON e.account_id=a.id WHERE e.is_replied=true AND e.sent_datetime >= (CURRENT_DATE - INTERVAL '30 days') AND e.subject NOT ILIKE 'ENC:%' AND e.subject NOT ILIKE 'FW:%' GROUP BY 1, 2 ORDER BY 1, 2 DESC;
